{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
Vision
{% endblock %}

{% block style %}
<link rel="stylesheet" href="{% static 'website/css/form-loader.css' %}">
{% endblock %}

{% block content %}

{% if user.is_authenticated %}

<div class="container mt-7">
    <div class="form-container">
        <h2 class="text-center" style="color: #E2E2E2">Upload a file</h2>
        <form id="myForm" class="form" action="" method="POST" enctype="multipart/form-data">
            <div class="form-group">
            {% csrf_token %}
            {{ form | crispy }}
            </div>
                <button type="submit" id="submitBtn" onclick="showLoadingScreen()" class="btn btn-light btn-lg rounded-3">Generate Narration</button>
            <div class="text-center">
            <div id="loading-container" style="display: none;">
                <div id="spinner-container">
                    <div class="dot-spinner">
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                    </div>
                </div>
            </div>
            </div>
        </form>
    </div>
</div>

{% else %}

<div class="container mt-7">
    <div class="form-container">
        <h2 class="text-center" style="color: #E2E2E2">Login</h2>
        <div class="text-center mt-5 mb-4">
        <a href="#" class="btn btn-light rounded-3"><img src="{% static 'website/img/google-auth-2.png' %}" width="20" height="20" alt="Google Login">  Sign In with Google</a>
            </div>
      <form class="form" action="{% url 'users:login' %}" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
        <div class="form-group">
          <label for="email">Email</label>
          <input name="email" id="email" type="email" required>
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input name="password" id="password" type="password" required>
        </div>
        <button type="submit" class="btn btn-light btn-lg rounded-3">Login</button>
      </form>
    </div>
</div>

{% endif %}

{% endblock %}

{% block script %}
<script type="text/javascript">
document.getElementById('myForm').addEventListener('submit', function(e) {
    // Show the spinner
    document.getElementById('loading-container').style.display = 'block';

    // Disable the submit button to prevent multiple submissions
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.style.display = 'none';

    // If you're using AJAX for form submission, remember to re-enable the
    // button and hide the spinner in your AJAX callback upon completion.
    // For traditional form submissions, the page will reload, so manual
    // re-enabling in JavaScript isn't necessary.
});
</script>
{% endblock %}
